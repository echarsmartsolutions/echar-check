<script type="text/html" data-template-name="echar-checkdev">
    <div class="form-row" id="div-node-logo">
        <svg
        width="55.5mm"
        height="15.5mm"
        viewBox="0 0 55.5 15.5"
        version="1.1"
        id="echarIcon"
        xmlns="http://www.w3.org/2000/svg">
       <g
          id="layer1">
         <path
            id="path1472"
            style="opacity:0.855626;fill:#d45500;fill-rule:evenodd;stroke:#d45500;stroke-width:0.370909;stroke-linecap:square"
            d="m 8.3989755,0.65086264 c -4.293642,-4e-5 -7.77439,3.16899996 -7.774447,7.07822996 -2.6e-5,3.9092904 3.480746,7.0784104 7.774447,7.0783704 2.8224195,-2.8e-4 5.3662595,-1.30756 6.7454375,-3.37593 -0.309941,-0.0102 -0.579776,-0.17359 -0.73655,-0.41729 -1.236964,1.87457 -3.48818,3.09624 -6.0088875,3.09646 -3.871061,6e-5 -7.009222,-2.85712 -7.009185,-6.3816104 1.29e-4,-3.52438 3.138241,-6.38139 7.009185,-6.38133 3.8708365,8e-5 7.0087815,2.85705 7.0089105,6.38133 -2.24e-4,0.13753 -0.0053,0.27501 -0.01531,0.41223 H 8.2433795 c -0.111003,-0.37733 -0.457262,-0.63648 -0.85058,-0.6366 -0.489802,-2e-5 -0.886895,0.39701 -0.886949,0.88681 -9.8e-5,0.48991 0.39704,0.88711 0.886949,0.88709 0.309453,-2e-5 0.596524,-0.16133 0.757469,-0.42563 h 7.1475525 c 0.300069,0.003 0.379209,0.0109 0.889547,0.006 -0.0051,-0.47888 -0.01412,-0.65412 -0.01422,-1.13033 -5.7e-5,-3.90914 -3.480638,-7.07813996 -7.7741725,-7.07822996 z M 7.3927995,7.9473126 c 0.245363,-10e-6 0.444294,0.19886 0.444364,0.44422 8.1e-5,0.24547 -0.198894,0.44451 -0.444364,0.4445 -0.245416,-7e-5 -0.444307,-0.19908 -0.444226,-0.4445 7e-5,-0.24531 0.198917,-0.44415 0.444226,-0.44422 z m 7.7641915,1.72016 a 0.8393771,0.8393771 0 0 0 -0.839368,0.8393704 0.8393771,0.8393771 0 0 0 0.839368,0.83951 0.8393771,0.8393771 0 0 0 0.839369,-0.83951 0.8393771,0.8393771 0 0 0 -0.839369,-0.8393704 z m 0,0.4189304 a 0.42053912,0.42053912 0 0 1 0.420573,0.42044 0.42053912,0.42053912 0 0 1 -0.420573,0.42057 0.42053912,0.42053912 0 0 1 -0.420436,-0.42057 0.42053912,0.42053912 0 0 1 0.420436,-0.42044 z" />
         <path
            id="path410"
            style="opacity:0.855626;fill:#333333;fill-rule:evenodd;stroke:#333333;stroke-width:0.239652;stroke-linecap:square"
            d="m 8.3988385,3.1558426 c -2.774272,-5e-5 -5.023231,2.0475 -5.023221,4.57339 -1e-5,2.5258904 2.248949,4.5735704 5.023221,4.5735204 1.304015,-2e-5 2.5554785,-0.46201 3.4913295,-1.28592 0.08633,0.0273 0.176341,0.0412 0.266891,0.0413 0.489858,3e-5 0.886971,-0.39709 0.88695,-0.88695 2.1e-5,-0.4898504 -0.397092,-0.8869704 -0.88695,-0.8869504 -0.489857,-2e-5 -0.886971,0.3971 -0.886949,0.8869504 2.15e-4,0.0541 0.0054,0.10815 0.01545,0.16134 -0.759,0.69854 -1.7967165,1.09779 -2.8867215,1.09861 -2.245556,-1e-5 -4.066026,-1.6573804 -4.066131,-3.7018904 -2e-6,-2.04458 1.820498,-3.70203 4.066131,-3.70203 1.7846235,-1e-5 3.3737215,1.03091 3.6269625,1.90502 H 8.2251965 c -0.127855,-0.34947 -0.460271,-0.58196 -0.832396,-0.58218 -0.489857,-3e-5 -0.886971,0.39709 -0.886949,0.88695 -2.2e-5,0.48985 0.397092,0.88697 0.886949,0.88695 0.325928,0 0.625598,-0.17876 0.780439,-0.46556 1.603007,-0.035 4.6957585,-0.0491 4.8107475,-0.0424 0.06245,10e-4 0.135604,10e-4 0.226967,-9.5e-4 -0.193426,-1.80669 -2.115273,-3.45904 -4.8121155,-3.4592 z m -1.006039,2.63678 c 0.245418,0 0.444369,0.19895 0.444364,0.44437 5e-6,0.24541 -0.198946,0.44436 -0.444364,0.44436 -0.245364,-7e-5 -0.444232,-0.199 -0.444226,-0.44436 -6e-6,-0.24537 0.198862,-0.4443 0.444226,-0.44437 z m 4.7642595,3.93433 c 0.245364,-1e-5 0.444294,0.19886 0.444364,0.4442304 5e-6,0.24541 -0.198946,0.44436 -0.444364,0.44436 -0.245364,-7e-5 -0.444232,-0.199 -0.444226,-0.44436 7e-5,-0.2453204 0.198916,-0.4441604 0.444226,-0.4442304 z"
            sodipodi:nodetypes="ccscccccccccccccccccccccccccccc" />
         <text
            xml:space="preserve"
            style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:11.8845px;font-family:'Accanthis ADF Std No2';-inkscape-font-specification:'Accanthis ADF Std No2, Bold';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;text-align:center;text-anchor:middle;opacity:0.855626;fill:#d45500;fill-rule:evenodd;stroke:#d45500;stroke-width:0.421105;stroke-linecap:square"
            x="30.709002"
            y="10.947147"
            id="text299"
            transform="scale(1.1899929,0.84034115)"><tspan
              sodipodi:role="line"
              id="tspan297"
              style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:11.8845px;font-family:'Accanthis ADF Std No2';-inkscape-font-specification:'Accanthis ADF Std No2, Bold';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;stroke-width:0.421106"
              x="30.709002"
              y="10.947147">Echar</tspan></text>
         <text
            xml:space="preserve"
            style="font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:3.99943px;font-family:'Accanthis ADF Std No2';-inkscape-font-specification:'Accanthis ADF Std No2 Italic';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;text-align:center;text-anchor:middle;opacity:0.855626;fill:#d45500;fill-rule:evenodd;stroke:#d45500;stroke-width:0.472373;stroke-linecap:square"
            x="38.178371"
            y="12.720703"
            id="text407"
            transform="scale(0.93847859,1.0655544)"><tspan
              sodipodi:role="line"
              id="tspan405"
              style="font-style:italic;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:3.99943px;font-family:sans-serif;-inkscape-font-specification:'sans-serif Bold Italic';fill:#000000;stroke:none;stroke-width:0.472374"
              x="38.178371"
              y="12.720703">Automação e Sistema</tspan></text>
       </g>
     </svg>
       
    </div>
    <div class="form-row" id="div-node-input-host">
        <label for="node-input-host"><i class="fa fa-dot-circle-o"></i> <span data-i18n="echar-checkdev.label.target"></span></label>
        <input type="text" id="node-input-host" placeholder="192.168.0.1, www.google.com">
    </div>
    <div class="form-row">
        <label for="node-protocol"><i class="fa fa-gear"></i> <span data-i18n="echar-checkdev.label.protocol"></label>
        <select type="text" id="node-input-protocol" style="width: 70%">
            <option value="Automatic" data-i18n="echar-checkdev.label.protocol_option.auto"></option>
            <option value="IPv4" data-i18n="echar-checkdev.label.protocol_option.ipv4"></option>
            <option value="IPv6" data-i18n="echar-checkdev.label.protocol_option.ipv6"></option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-mode"><i class="fa fa-wrench"></i> <span data-i18n="echar-checkdev.label.mode"></label>
        <select type="text" id="node-input-mode" style="width: 70%">
            <option value="timed" data-i18n="echar-checkdev.label.mode_option.timed"></option>
            <option value="triggered" data-i18n="echar-checkdev.label.mode_option.triggered"></option>
        </select>
    </div>
    <div class="form-row" id="div-node-input-timer">
        <label for="node-input-timer"><i class="fa fa-repeat"></i> <span data-i18n="echar-checkdev.label.ping"></label>
        <input type="text" id="node-input-timer" placeholder="20">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> <span data-i18n="node-red:common.label.name"></span></label>
        <input type="text" id="node-input-name" data-i18n="[placeholder]node-red:common.label.name">
    </div>
    <div class="form-tips" id="node-device-tip"><span data-i18n="echar-checkdev.label.tip"></span></div>
    <div class="form-row" style="background-color:#c0c0c0;border-color: chocolate;border-style:dotted;border-width: 2px;margin-top: 10px;">
    <div class="form-row" style="padding-top: 10px;padding-left: 10px;">
            <label for="node-input-key"><i class="fa fa-key"></i> <span data-i18n="echar-checkdev.label.key"></span></label>
        <input type="text" id="node-input-key" data-i18n="echar-checkdev.label.key"
        placeholder="To get key & Hash send Telegram message to">
    </div>
    <div class="form-row" style="padding-left: 10px;">
        <label for="node-input-hash"><i class="fa fa-address-card-o"></i> <span data-i18n="echar-checkdev.label.hash"></span></label>
        <input type="text" id="node-input-hash" data-i18n="echar-checkdev.label.hash"
        placeholder="@DeviceMonitor2DerBot UC20-Serial & Your ID">
    </div>
    </div>
</script>
<script type="text/javascript">

var timerParameterValidator = function(node,v){
        var mode = getMode(node)
        if(mode === "triggered"){
            return true;
        }
        if(v == ""){
            return false;
        }
        return RED.validators.number()(v);
    }
    var hostParameterValidator = function(node,v){
        var mode = getMode(node)
        if(mode === "triggered"){
            return true;
        }
        return v != ""
    }
    var getMode = function(node){
        if(node){
            return node.mode
        } else {
            let $mode = $( "#node-input-mode" );
            return $mode.val();
        }
    }
    var hashParameterValidator = function(node,v){
            let $hash = $( "#node-input-hash" )
            return RED.validators.regex(/[a-z0-9]/) ($hash.val())
    }
    var keyParameterValidator = function(node,v){
            let $key = $( "#node-input-key" )
            return RED.validators.regex(/[a-z0-9]/) ($key.val())
    }


    RED.nodes.registerType('echar-checkdev',{
        category: "Echar",
        color:"#f4b100",
        defaults: {
            protocol: {value:"Automatic"},
            mode: {value:"timed"},
            hash: {value:"", validate: function(v){
                    return hashParameterValidator(this,v) ;
                }},
            key: {value:"", validate: function(v){
                    return keyParameterValidator(this,v) ;
                }},
            host: {value:"", validate: function(v){
                    return hostParameterValidator(this,v) ;
                }
            },
            timer: {value:"20", validate: function(v){
                    return timerParameterValidator(this,v) ;
                }
            },
            inputs: {value:0}
        },
        inputs:0,
        outputs:1,
        //icon: "font-awesome/fa-podcast",
        icon: "echar2.svg",
        paletteLabel: function() {
            return this._("echar-checkdev");
        },
        label: function() {
            let lbl = this.name||this.host||this._("echar-checkdev");
            if (lbl.split(',').length > 1){
                lbl = this._("echar-checkdev");
            }
            return lbl;
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        oneditprepare: function () {
            let node = this;
            let $timer = $("#div-node-input-timer");
            let $tip = $("#node-device-tip");
            $("#node-input-mode").val(node.mode);
            let $mode = $( "#node-input-mode" );
            let $hash = $( "#node-input-hash" );
            let $key = $( "#node-input-key" );

            function updateControlsVisibility(){
                //node.mode = $mode.val();
                switch ($mode.val()) {
                    case "triggered":
                        node.inputs = 1;
                        node._def.inputs = 1
                        $timer.hide();
                        $tip.show();
                        break;
                    default:
                        node.inputs = 0;
                        node._def.inputs = 0;
                        $timer.show();
                        $tip.hide();
                        break;
                }
            }
            $mode.change(updateControlsVisibility);
            updateControlsVisibility();

        }

    });
</script>
